/*
Deployment script for SujaanDB

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "SujaanDB"
:setvar DefaultFilePrefix "SujaanDB"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL15.SQLEXPRESS\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL15.SQLEXPRESS\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Starting rebuilding table [dbo].[T_Assignments]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_Assignments] (
    [Id]               INT           IDENTITY (1, 1) NOT NULL,
    [AssignmentName]   VARCHAR (50)  NULL,
    [TopicID]          INT           NULL,
    [AssignmentSource] VARCHAR (200) NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_Assignments])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Assignments] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_Assignments] ([Id], [AssignmentName], [TopicID], [AssignmentSource])
        SELECT   [Id],
                 [AssignmentName],
                 [TopicID],
                 [AssignmentSource]
        FROM     [dbo].[T_Assignments]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Assignments] OFF;
    END

DROP TABLE [dbo].[T_Assignments];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_Assignments]', N'T_Assignments';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_CoursePathMapping]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_CoursePathMapping] (
    [Id]       INT IDENTITY (1, 1) NOT NULL,
    [PathID]   INT NOT NULL,
    [CourseID] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_CoursePathMapping])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_CoursePathMapping] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_CoursePathMapping] ([Id], [PathID], [CourseID])
        SELECT   [Id],
                 [PathID],
                 [CourseID]
        FROM     [dbo].[T_CoursePathMapping]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_CoursePathMapping] OFF;
    END

DROP TABLE [dbo].[T_CoursePathMapping];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_CoursePathMapping]', N'T_CoursePathMapping';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_Courses]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_Courses] (
    [Id]         INT          IDENTITY (1, 1) NOT NULL,
    [CourseName] VARCHAR (50) NULL,
    [SubjectID]  INT          NULL,
    [ProjectID]  INT          NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_Courses])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Courses] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_Courses] ([Id], [CourseName], [SubjectID], [ProjectID])
        SELECT   [Id],
                 [CourseName],
                 [SubjectID],
                 [ProjectID]
        FROM     [dbo].[T_Courses]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Courses] OFF;
    END

DROP TABLE [dbo].[T_Courses];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_Courses]', N'T_Courses';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_CourseTopics]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_CourseTopics] (
    [Id]           INT           IDENTITY (1, 1) NOT NULL,
    [TopicName]    VARCHAR (50)  NULL,
    [TopicMentor]  INT           NULL,
    [TopicSource]  VARCHAR (200) NULL,
    [AssignmentID] INT           NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_CourseTopics])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_CourseTopics] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_CourseTopics] ([Id], [TopicName], [TopicMentor], [TopicSource], [AssignmentID])
        SELECT   [Id],
                 [TopicName],
                 [TopicMentor],
                 [TopicSource],
                 [AssignmentID]
        FROM     [dbo].[T_CourseTopics]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_CourseTopics] OFF;
    END

DROP TABLE [dbo].[T_CourseTopics];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_CourseTopics]', N'T_CourseTopics';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_EmployeeCourseMappings]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_EmployeeCourseMappings] (
    [Id]         INT IDENTITY (1, 1) NOT NULL,
    [EmployeeID] INT NOT NULL,
    [CourseID]   INT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_EmployeeCourseMappings])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_EmployeeCourseMappings] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_EmployeeCourseMappings] ([Id], [EmployeeID], [CourseID])
        SELECT   [Id],
                 [EmployeeID],
                 [CourseID]
        FROM     [dbo].[T_EmployeeCourseMappings]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_EmployeeCourseMappings] OFF;
    END

DROP TABLE [dbo].[T_EmployeeCourseMappings];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_EmployeeCourseMappings]', N'T_EmployeeCourseMappings';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_Employees]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_Employees] (
    [Id]           INT           IDENTITY (1, 1) NOT NULL,
    [EmailAddress] VARCHAR (50)  NOT NULL,
    [Password]     VARCHAR (100) NOT NULL,
    [EmployeeID]   INT           NOT NULL,
    [FirstName]    VARCHAR (20)  NULL,
    [MiddleName]   VARCHAR (20)  NULL,
    [LastName]     VARCHAR (20)  NULL,
    [ProjectID]    INT           NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_Employees])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Employees] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_Employees] ([Id], [EmailAddress], [Password], [EmployeeID], [FirstName], [MiddleName], [LastName], [ProjectID])
        SELECT   [Id],
                 [EmailAddress],
                 [Password],
                 [EmployeeID],
                 [FirstName],
                 [MiddleName],
                 [LastName],
                 [ProjectID]
        FROM     [dbo].[T_Employees]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Employees] OFF;
    END

DROP TABLE [dbo].[T_Employees];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_Employees]', N'T_Employees';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_EmployeeSubjectProficiency]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_EmployeeSubjectProficiency] (
    [Id]          INT IDENTITY (1, 1) NOT NULL,
    [EmployeeID]  INT NOT NULL,
    [SubjectID]   INT NOT NULL,
    [Proficiency] INT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_EmployeeSubjectProficiency])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_EmployeeSubjectProficiency] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_EmployeeSubjectProficiency] ([Id], [EmployeeID], [SubjectID], [Proficiency])
        SELECT   [Id],
                 [EmployeeID],
                 [SubjectID],
                 [Proficiency]
        FROM     [dbo].[T_EmployeeSubjectProficiency]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_EmployeeSubjectProficiency] OFF;
    END

DROP TABLE [dbo].[T_EmployeeSubjectProficiency];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_EmployeeSubjectProficiency]', N'T_EmployeeSubjectProficiency';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_LearningPaths]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_LearningPaths] (
    [Id]       INT          IDENTITY (1, 1) NOT NULL,
    [PathName] VARCHAR (50) NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_LearningPaths])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_LearningPaths] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_LearningPaths] ([Id], [PathName])
        SELECT   [Id],
                 [PathName]
        FROM     [dbo].[T_LearningPaths]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_LearningPaths] OFF;
    END

DROP TABLE [dbo].[T_LearningPaths];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_LearningPaths]', N'T_LearningPaths';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_Mentors]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_Mentors] (
    [Id]         INT IDENTITY (1, 1) NOT NULL,
    [EmployeeID] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_Mentors])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Mentors] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_Mentors] ([Id], [EmployeeID])
        SELECT   [Id],
                 [EmployeeID]
        FROM     [dbo].[T_Mentors]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Mentors] OFF;
    END

DROP TABLE [dbo].[T_Mentors];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_Mentors]', N'T_Mentors';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_Projects]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_Projects] (
    [Id]          INT          IDENTITY (1, 1) NOT NULL,
    [ProjectName] VARCHAR (50) NULL,
    [ProjectType] INT          NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_Projects])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Projects] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_Projects] ([Id], [ProjectName], [ProjectType])
        SELECT   [Id],
                 [ProjectName],
                 [ProjectType]
        FROM     [dbo].[T_Projects]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Projects] OFF;
    END

DROP TABLE [dbo].[T_Projects];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_Projects]', N'T_Projects';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_Subjects]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_Subjects] (
    [Id]          INT          IDENTITY (1, 1) NOT NULL,
    [SubjectName] VARCHAR (50) NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_Subjects])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Subjects] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_Subjects] ([Id], [SubjectName])
        SELECT   [Id],
                 [SubjectName]
        FROM     [dbo].[T_Subjects]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_Subjects] OFF;
    END

DROP TABLE [dbo].[T_Subjects];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_Subjects]', N'T_Subjects';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[T_TopicCourseMapping]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_T_TopicCourseMapping] (
    [Id]       INT IDENTITY (1, 1) NOT NULL,
    [CourseID] INT NOT NULL,
    [TopicID]  INT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[T_TopicCourseMapping])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_TopicCourseMapping] ON;
        INSERT INTO [dbo].[tmp_ms_xx_T_TopicCourseMapping] ([Id], [CourseID], [TopicID])
        SELECT   [Id],
                 [CourseID],
                 [TopicID]
        FROM     [dbo].[T_TopicCourseMapping]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_T_TopicCourseMapping] OFF;
    END

DROP TABLE [dbo].[T_TopicCourseMapping];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_T_TopicCourseMapping]', N'T_TopicCourseMapping';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Update complete.';


GO
